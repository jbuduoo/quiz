# 資料儲存位置說明

## 資料流程

### 1. **來源資料（Excel 檔案）**
📁 **位置**：`date/第34屆理財規劃人員專業能力.xlsx`
- 這是原始的 Excel 題庫檔案
- 包含所有題目的完整資料

### 2. **轉換後的 JSON 檔案**
📁 **位置**：`assets/data/questions.json`
- 由 Excel 轉換而來
- 格式包含：
  ```json
  {
    "metadata": {
      "sourceFileName": "第34屆理財規劃人員專業能力",
      "totalQuestions": 50,
      "convertedAt": "2025-12-09T09:06:06.100Z"
    },
    "questions": [
      {
        "id": "1",
        "content": "...",
        "options": {...},
        "correctAnswer": "D",
        "explanation": "...",
        "subject": "理財工具",
        "chapter": "金融機構業務"
      },
      ...
    ]
  }
  ```

### 3. **執行時儲存（AsyncStorage）**

App 執行時，資料會儲存在裝置的本地儲存空間：

#### **React Native（iOS/Android）**
- 使用 `@react-native-async-storage/async-storage`
- 儲存位置：
  - **iOS**：`NSUserDefaults`（應用程式沙盒）
  - **Android**：`SharedPreferences`（應用程式私有資料夾）

#### **Web 平台**
- 使用瀏覽器的 `LocalStorage`
- 儲存位置：瀏覽器的本地儲存空間

### 4. **儲存的資料鍵值**

系統使用以下鍵值儲存資料：

| 鍵值 | 說明 | 內容 |
|------|------|------|
| `@quiz:questions` | 題目資料 | 所有題目的 JSON 陣列 |
| `@quiz:userAnswers` | 用戶答題記錄 | 答題狀態、錯題、收藏等 |
| `@quiz:chapters` | 章節列表 | 章節資訊與進度 |
| `@quiz:dataVersion` | 資料版本 | 版本號（用於判斷是否需要更新） |

## 資料載入流程

```
1. App 啟動
   ↓
2. 檢查 AsyncStorage 是否有資料
   ↓
3. 如果沒有資料或版本不同：
   ├─ 從 assets/data/questions.json 載入
   ├─ 儲存到 AsyncStorage (@quiz:questions)
   └─ 儲存版本號 (@quiz:dataVersion)
   ↓
4. 如果有資料：
   └─ 直接從 AsyncStorage 讀取
   ↓
5. 動態生成章節列表
   └─ 儲存到 AsyncStorage (@quiz:chapters)
```

## 資料更新方式

### 更新題目資料

1. **更新 Excel 檔案**
   - 修改 `date/第34屆理財規劃人員專業能力.xlsx`

2. **執行轉換**
   ```bash
   npm run convert:excel
   ```
   - 會更新 `assets/data/questions.json`

3. **更新版本號**
   - 在 `src/services/QuestionService.ts` 中修改：
   ```typescript
   const currentVersion = '1.0.1'; // 從 1.0.0 改為 1.0.1
   ```

4. **重新啟動 App**
   - App 會偵測版本號不同，自動重新載入資料

### 清除資料

如果需要清除所有儲存的資料：

#### **React Native**
- 刪除 App 並重新安裝
- 或在 App 中實作清除功能

#### **Web**
- 清除瀏覽器的 LocalStorage：
  ```javascript
  localStorage.clear();
  ```
- 或在瀏覽器開發者工具中手動清除

## 資料備份

### 題目資料
- ✅ 已備份：`assets/data/questions.json`（在專案中）
- ✅ 來源檔案：`date/第34屆理財規劃人員專業能力.xlsx`

### 用戶答題記錄
- ⚠️ 僅存在裝置本地（AsyncStorage）
- ⚠️ 清除 App 資料會遺失
- 💡 建議：未來可加入雲端同步功能

## 檔案結構

```
quiz/
├── date/                                    # 來源資料
│   └── 第34屆理財規劃人員專業能力.xlsx      # Excel 題庫檔案
│
├── assets/
│   └── data/
│       └── questions.json                    # 轉換後的 JSON 檔案
│
├── src/
│   └── services/
│       └── QuestionService.ts                # 資料管理服務
│           ├── 從 JSON 載入題目
│           ├── 儲存到 AsyncStorage
│           └── 管理用戶答題記錄
│
└── [裝置本地儲存]                            # AsyncStorage
    ├── @quiz:questions                      # 題目資料
    ├── @quiz:userAnswers                    # 答題記錄
    ├── @quiz:chapters                       # 章節列表
    └── @quiz:dataVersion                    # 資料版本
```

## 注意事項

1. **JSON 檔案位置**
   - `assets/data/questions.json` 會被打包進 App
   - 修改後需要重新建置 App 才會生效

2. **AsyncStorage 限制**
   - 儲存大小限制約 6MB（iOS）或 10MB（Android）
   - 目前 50 題的資料量遠小於限制

3. **資料同步**
   - 不同裝置之間的資料不會自動同步
   - 需要實作雲端同步功能才能跨裝置使用

