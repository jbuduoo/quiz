# 本地題庫伺服器使用指南

## 概述

本地題庫伺服器是一個簡單的 HTTP 伺服器，用於測試題庫匯入功能。它會掃描 `assets/data/questions` 目錄下的所有 JSON 檔案，並提供一個網頁介面讓您選擇和下載題庫。

## 啟動伺服器

### 方法一：使用 npm script（推薦）

```bash
npm run quiz-server
```

### 方法二：直接執行 Node.js

```bash
node scripts/local-quiz-server.js
```

## 使用步驟

### 1. 啟動伺服器

在終端機中執行：

```bash
npm run quiz-server
```

您會看到類似以下的訊息：

```
╔══════════════════════════════════════════════════════════╗
║           題庫下載測試伺服器已啟動                        ║
╠══════════════════════════════════════════════════════════╣
║  伺服器網址：http://localhost:3000                        ║
║  題庫目錄：.../assets/data/questions                      ║
╠══════════════════════════════════════════════════════════╣
║  使用說明：                                               ║
║  1. 在瀏覽器中打開 http://localhost:3000                 ║
║  2. 在 App 中點擊「匯入題庫」按鈕                        ║
║  3. App 會自動檢測或提示輸入伺服器網址                  ║
║  4. 選擇要下載的題庫                                     ║
╠══════════════════════════════════════════════════════════╣
║  按 Ctrl+C 停止伺服器                                    ║
╚══════════════════════════════════════════════════════════╝
```

### 2. 在瀏覽器中預覽（可選）

打開瀏覽器，訪問 `http://localhost:3000`，您會看到一個美觀的題庫列表頁面，顯示所有可用的題庫檔案。

### 3. 在 App 中測試匯入

#### 方法 A：使用 Web 版本（同一台電腦，最簡單）

1. **啟動 App 的 Web 版本：**
   ```bash
   npm run web
   ```

2. **在瀏覽器中打開 App**（通常是 `http://localhost:8081`）

3. **點擊「匯入題庫」按鈕**
   - App 會自動使用 `http://localhost:3000`
   - 如果沒有自動連接，點擊右上角的 ⚙️ 按鈕設定

4. **選擇要下載的題庫**
   - 點擊任何題庫的「📥 下載題庫」按鈕
   - 自動跳轉到匯入設定畫面

#### 方法 B：使用手機 App（需要同一 Wi-Fi）

1. **確認手機和電腦在同一 Wi-Fi 網路**

2. **在 App 中匯入：**
   - 點擊「匯入題庫」按鈕
   - 如果首次使用，會顯示伺服器設定對話框
   - **點擊「自動檢測」按鈕**（推薦）
     - App 會自動掃描常見的本地 IP 地址
     - 找到後自動連接
   - 或**手動輸入**電腦的 IP 位址：
     - Windows: 執行 `ipconfig`，找到「IPv4 位址」
     - macOS/Linux: 執行 `ifconfig` 或 `ip addr`
     - 格式：`http://[您的IP]:3000`（例如：`http://192.168.1.100:3000`）

3. **選擇要下載的題庫**
   - 點擊任何題庫的「📥 下載題庫」按鈕
   - 自動跳轉到匯入設定畫面

### 4. 伺服器 URL 設定

App 會記住您設定的伺服器 URL，下次使用時會自動連接。

**重新設定伺服器：**
- 在匯入畫面點擊右上角的 ⚙️ 按鈕
- 可以：
  - 點擊「自動檢測」自動尋找本地伺服器
  - 手動輸入新的伺服器 URL
  - 點擊「確定」儲存設定

## 整合功能特色

### ✨ 自動檢測本地伺服器

- **Web 版本**：自動使用 `http://localhost:3000`
- **手機版本**：提供「自動檢測」功能，自動掃描常見的本地 IP 地址
- **智能記憶**：記住您設定的伺服器 URL，下次自動連接

### 📱 簡化的使用流程

1. 啟動本地伺服器：`npm run quiz-server`
2. 在 App 中點擊「匯入題庫」
3. 點擊「自動檢測」或輸入 IP 地址
4. 選擇題庫並下載
5. 完成匯入

### 🔧 伺服器設定

- 點擊匯入畫面右上角的 ⚙️ 按鈕可以重新設定伺服器
- 支援自動檢測和手動輸入兩種方式
- 設定會自動儲存，下次使用時自動連接

## 伺服器功能

### 提供的頁面

- **首頁 (`/`)**：顯示所有題庫檔案的列表
- **下載端點 (`/download/[檔案路徑]`)**：提供 JSON 檔案下載

### 自動掃描題庫

伺服器會自動掃描 `assets/data/questions` 目錄下的所有 JSON 檔案，並顯示：
- 檔案名稱
- 來源資訊（source）
- 題目數量
- 匯入日期

### CORS 支援

伺服器已設定 CORS 標頭，允許從任何來源訪問，方便跨域測試。

## 疑難排解

### 問題：無法啟動伺服器

**解決方案：**
- 確認 3000 埠口未被占用
- 檢查 Node.js 是否已安裝：`node --version`
- 確認 `assets/data/questions` 目錄存在

### 問題：手機無法連接到伺服器

**解決方案：**
1. 確認手機和電腦在同一 Wi-Fi 網路
2. 確認防火牆允許 3000 埠口
3. 使用電腦的區域網路 IP，而不是 `localhost`
4. 嘗試在手機瀏覽器中直接訪問 `http://[IP]:3000` 測試連線

### 問題：下載失敗

**解決方案：**
- 確認檔案路徑正確
- 檢查檔案是否存在於 `assets/data/questions` 目錄
- 查看伺服器終端機的錯誤訊息

## 停止伺服器

在終端機中按 `Ctrl+C`（Windows/Linux）或 `Cmd+C`（macOS）停止伺服器。

## 自訂設定

如需修改伺服器設定，編輯 `scripts/local-quiz-server.js`：

- **修改埠口**：更改 `PORT` 常數（預設：3000）
- **修改題庫目錄**：更改 `QUIZ_DIR` 路徑

## 注意事項

1. 此伺服器僅用於開發和測試，不適合生產環境使用
2. 確保題庫檔案格式正確（符合 `ImportedQuestionData` 介面）
3. 伺服器會自動掃描所有子目錄中的 JSON 檔案

