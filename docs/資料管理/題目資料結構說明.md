# 題目資料結構說明

## 資料夾結構

題目資料和圖片都採用相同的資料夾結構，支援兩種格式：

### 三層結構（有科目）

```
questions/
├── IPAS_01/              # 第一層：證照別
│   ├── L11/              # 第二層：科目
│   │   ├── 11401.json    # 第三層：考古題檔案（期數或日期）
│   │   └── 11409.json
│   └── L12/
│       └── 11409.json
└── IPAS_02/
    ├── L21/
    │   └── 11409.json
    └── L22/
        └── 11409.json
```

### 兩層結構（沒有科目）

```
questions/
├── NEW_CERT/              # 第一層：證照別
│   ├── 20251216.json     # 第二層：考古題檔案（直接）
│   └── 20251220.json
└── ANOTHER_CERT/
    └── 20250101.json
```

### 圖片資料結構

```
images/
├── IPAS_01/              # 第一層：證照別
│   ├── L11/              # 第二層：科目
│   │   └── 11401/        # 第三層：期數資料夾
│   │       ├── 3Q1.png   # 題目圖片
│   │       ├── 5A1.png   # 選項 A 圖片
│   │       └── 5B1.png   # 選項 B 圖片
│   └── L12/
│       └── 11409/
└── IPAS_02/
    ├── L21/
    │   └── 11409/
    └── L23/
        └── 11411/
            ├── 41Q1.png
            └── 45A1.png
```

## 檔案格式

每個 JSON 檔案支援兩種格式：

### 陣列格式（用於匯入）

```json
[
  {
    "Id": "1",
    "Q": "題目內容...",
    "A": "選項A",
    "B": "選項B",
    "C": "選項C",
    "D": "選項D",
    "Ans": "C",
    "Exp": "詳解..."
  }
]
```

### 格式說明

#### 陣列格式欄位：
 - **id**: 題目序號（簡化為數字，系統會自動生成完整 ID）
 - **Q**: 題目內容
 - **A, B, C, D**: 選項
 - **Ans**: 正確答案（A/B/C/D）
 - **Exp**: 詳解

**注意**：系統會自動識別兩種格式，並統一轉換為內部格式。陣列格式主要用於匯入功能，物件格式用於資料夾結構中的題目檔案。

## 檔名規則

- 可以使用期數：`11401.json`
- 也可以使用日期：`2024-12-20.json`
- 系統會自動從資料夾路徑解析 `testName`、`subject`（如果有）、`series_no`

## 題目 ID 生成規則

系統會根據資料夾結構自動生成題目 ID：

- **三層結構**：`{testName}_{subject}_{series_no}_{題號}`
  - 例如：`IPAS_01_L11_11401_1`
- **兩層結構**：`{testName}_{series_no}_{題號}`
  - 例如：`NEW_CERT_20251216_1`

## 匯入新題目

### 三層結構（有科目）

1. 將 JSON 檔案放入對應的資料夾：
   - 證照別資料夾：`questions/{testName}/`
   - 科目資料夾：`questions/{testName}/{subject}/`
   - 檔案：`questions/{testName}/{subject}/{filename}.json`

2. 執行更新索引腳本：
   ```bash
   node scripts/updateQuestionIndex.js
   ```

### 兩層結構（沒有科目）

1. 將 JSON 檔案放入對應的資料夾：
   - 證照別資料夾：`questions/{testName}/`
   - 檔案：`questions/{testName}/{filename}.json`

2. 執行更新索引腳本：
   ```bash
   node scripts/updateQuestionIndex.js
   ```

3. 系統會自動：
   - 掃描所有資料夾（支援兩層和三層結構）
   - 更新索引檔案（`questions.json`）
   - 更新映射檔案（`questionFileMap.ts`）

## 去重機制

同一資料夾內的題目會自動檢查重複：
- 完全相同的題目會被跳過
- 內容高度相似（>90%）且選項相同的題目會被視為重複
- 匯入時可以選擇跳過或合併重複題目

## 圖片檔名規則

圖片檔名遵循以下規則：
- **題目圖片**：`{題號}Q{序號}.png`（例如：`3Q1.png`, `41Q1.png`）
- **選項圖片**：`{題號}{選項}{序號}.png`（例如：`5A1.png`, `45B1.png`）

## 導航邏輯

系統會根據證照是否有科目自動調整導航：

- **有科目**：測驗名稱列表 → 科目列表 → 期數列表 → 作答頁
- **沒有科目**：測驗名稱列表 → 期數列表 → 作答頁（跳過科目列表）

## 優點

1. **結構清晰**：資料夾結構反映層級關係
2. **檔名簡潔**：不需要在檔名中重複資訊
3. **易於管理**：新增檔案只需放入對應資料夾
4. **自動去重**：同一資料夾內檢查重複
5. **擴展性好**：新增證照或科目只需新增資料夾
6. **統一結構**：題目和圖片使用相同的資料夾結構，便於管理
7. **靈活支援**：同時支援有科目和沒有科目的證照結構
8. **向後相容**：系統同時支援新舊格式，確保平滑遷移




